extends ../layouts/application.pug

block content
  h1= t('views.tasks.edit.title')

  form(method="post" action=`/tasks/${task.id}`)
    input(type="hidden" name="_method" value="PATCH")
    .mb-3
      label.form-label(for="data_name")= t('views.tasks.name')
      input#data_name.form-control(
        type="text"
        name="data[name]"
        value=task.name || ''
        class={'is-invalid': errors && errors.name}
      )
      if errors && errors.name
        .invalid-feedback.d-block= errors.name[0].message

    .mb-3
      label.form-label(for="data_description")= t('views.tasks.description')
      textarea#data_description.form-control(
        name="data[description]"
        rows="3"
        class={'is-invalid': errors && errors.description}
      )= task.description || ''
      if errors && errors.description
        .invalid-feedback.d-block= errors.description[0].message

    .mb-3
      label.form-label(for="data_statusId")= t('views.tasks.status')
      select#data_statusId.form-select(
        name="data[statusId]"
        class={'is-invalid': errors && errors.statusId}
      )
        option(value="")= t('views.tasks.selectStatus')
        each status in statuses
          option(value=status.id selected=(task.statusId == status.id))= status.name
      if errors && errors.statusId
        .invalid-feedback.d-block= errors.statusId[0].message

    .mb-3
      label.form-label(for="data_executorId")= t('views.tasks.executor')
      select#data_executorId.form-select(
        name="data[executorId]"
        class={'is-invalid': errors && errors.executorId}
      )
        option(value="")= t('views.tasks.selectExecutor')
        each user in users
          option(value=user.id selected=(task.executorId == user.id))= user.fullName
      if errors && errors.executorId
        .invalid-feedback.d-block= errors.executorId[0].message

    .mb-3
      label.form-label(for="data_labels")= t('views.tasks.labels')
      select#data_labels.form-select(
        name="data[labels]"
        multiple
        size="3"
      )
        each label in labels
          - const selectedLabels = task.labels || []
          - const isSelected = selectedLabels.some(l => l.id == label.id) || (Array.isArray(task.labelIds) && task.labelIds.includes(String(label.id)))
          option(value=label.id selected=isSelected)= label.name

    button.btn.btn-primary.me-2(type="submit")= t('views.tasks.edit.submit')

  hr

  form.mt-3(method="post" action=`/tasks/${task.id}`)
    input(type="hidden" name="_method" value="DELETE")
    button.btn.btn-danger(type="submit")= t('views.tasks.edit.delete')
